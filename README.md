# "你比划我猜"小程序项目

一款轻量级、高灵活性的双人或单人辅助互动小程序，基于微信原生小程序框架和Go后端实现。

## 项目概述

本项目实现了"你比划我猜"游戏的完整功能，包括：
- 双人互动模式和个人练习模式
- 四个学段词汇库（小学、初中、高中、大学）
- 自定义游戏参数（词汇数量、展示时间、提示功能）
- 本地存储的游戏记录和最佳成绩

## 项目结构

```
miniapp/
├── backend/                 # 后端服务（Go）
│   ├── cmd/
│   │   └── main.go         # 主程序入口
│   ├── internal/
│   │   ├── config/         # 配置管理
│   │   ├── handler/        # HTTP处理器
│   │   │   ├── auth_handler.go    # 认证相关API
│   │   │   └── word_handler.go    # 词库相关API
│   │   ├── service/        # 业务逻辑层
│   │   │   ├── auth_service.go    # 认证服务
│   │   │   └── word_service.go    # 词库服务
│   │   ├── model/          # 数据模型
│   │   ├── middleware/     # 中间件
│   │   └── response/       # 统一响应格式
│   └── data/               # 词库数据文件
│       ├── words_primary.json     # 小学词库（50个词汇）
│       ├── words_junior.json      # 初中词库（50个词汇）
│       ├── words_senior.json      # 高中词库（50个词汇）
│       └── words_university.json  # 大学词库（50个词汇）
│
└── miniapp/                # 小程序前端
    ├── pages/              # 页面文件
    │   ├── launch/         # 启动页
    │   ├── home/           # 首页
    │   ├── settings/       # 设置页
    │   ├── prepare/        # 游戏准备页
    │   ├── game/           # 游戏进行页
    │   ├── result/         # 结果页
    │   ├── history/        # 历史记录页
    │   └── about/          # 关于页
    ├── components/         # 公共组件
    ├── utils/              # 工具类
    │   ├── storage.js      # 存储管理
    │   ├── api.js          # API请求封装
    │   └── util.js         # 通用工具函数
    ├── images/             # 图片资源
    ├── app.js              # 小程序入口
    ├── app.json            # 小程序配置
    └── app.wxss            # 全局样式
```

## 技术栈

### 后端
- **语言**: Go 1.21
- **框架**: Gin (Web框架)
- **认证**: JWT (golang-jwt/jwt/v5)
- **数据存储**: JSON文件（内存缓存）

### 前端
- **框架**: 微信原生小程序
- **数据存储**: wx.storage（本地存储）

## 快速开始

### 环境要求

**后端**
- Go 1.21 或更高版本
- 端口 8080 可用

**前端**
- 微信开发者工具
- Node.js (可选，用于开发工具)

### 后端启动

1. 进入后端目录
```bash
cd backend
```

2. 下载依赖
```bash
go mod tidy
```

3. 配置微信小程序信息
编辑 `internal/config/config.go`，修改：
```go
WeChat: WeChatConfig{
    AppID:     "your-wechat-appid",      // 替换为你的AppID
    AppSecret: "your-wechat-appsecret",  // 替换为你的AppSecret
},
```

4. 启动服务
```bash
go run cmd/main.go
```

服务将在 `http://localhost:8080` 启动

### 前端启动

1. 使用微信开发者工具打开 `miniapp` 目录

2. 配置AppID
   - 在微信开发者工具中配置你的AppID
   - 或使用测试号AppID进行开发

3. 配置后端API地址（如需修改）
编辑 `miniapp/app.js`：
```javascript
globalData: {
  apiBase: 'http://localhost:8080/api'  // 修改为实际后端地址
}
```

4. 编译运行
   - 点击微信开发者工具的"编译"按钮
   - 在模拟器或真机上预览

## API接口文档

### 认证相关

#### 1. 微信登录
- **接口**: `POST /api/auth/wechat-login`
- **请求参数**:
  ```json
  {
    "code": "微信登录code",
    "nickName": "用户昵称（可选）",
    "avatarUrl": "用户头像URL（可选）"
  }
  ```
- **响应数据**:
  ```json
  {
    "code": 0,
    "message": "success",
    "data": {
      "userId": "用户ID",
      "token": "JWT令牌",
      "expiresIn": 2592000,
      "isNewUser": true
    }
  }
  ```

#### 2. Token验证
- **接口**: `POST /api/auth/verify-token`
- **请求参数**:
  ```json
  {
    "token": "JWT令牌"
  }
  ```

### 词库相关

#### 1. 获取词库列表
- **接口**: `GET /api/words/list`
- **请求参数**:
  - `educationLevel`: 学段（primary/junior/senior/university）
  - `count`: 数量（默认50）
  - `excludeIds`: 排除的词汇ID（逗号分隔）
- **响应数据**:
  ```json
  {
    "code": 0,
    "message": "success",
    "data": {
      "words": [
        {
          "wordId": "p001",
          "content": "苹果",
          "educationLevel": "primary",
          "category": "水果",
          "difficulty": 1,
          "charCount": 2
        }
      ],
      "total": 50,
      "version": "1.0.0"
    }
  }
  ```

#### 2. 获取词库版本
- **接口**: `GET /api/words/version`
- **响应数据**:
  ```json
  {
    "code": 0,
    "message": "success",
    "data": {
      "version": "1.0.0"
    }
  }
  ```

## 核心功能说明

### 1. 游戏模式
- **双人互动模式**: 一人比划，一人猜测，支持实时答题和提示功能
- **个人练习模式**: 查看词汇进行自主练习，无需答题

### 2. 词汇管理
- **分学段词库**: 小学、初中、高中、大学四个学段
- **本地缓存**: 词库自动缓存到本地，有效期7天
- **随机抽取**: 使用Fisher-Yates算法确保随机性

### 3. 游戏参数
- **学段选择**: 可选择不同难度的词汇
- **展示时间**: 5秒/10秒/15秒/20秒可选
- **提示功能**: 2次错误后显示字数提示（双人模式）

### 4. 数据存储
- **游戏配置**: 持久化存储用户的游戏偏好设置
- **游戏记录**: 最多保存20局游戏记录
- **最佳成绩**: 按学段记录最高分

## 词库数据

每个学段包含50个精选词汇：

### 小学词库
- 特征：常见名词、简单动作、日常物品
- 示例：苹果、跑步、书包、小狗、游泳等

### 初中词库
- 特征：成语、抽象概念、学科词汇
- 示例：守株待兔、光合作用、刻舟求剑等

### 高中词库
- 特征：复杂成语、专业术语、文化词汇
- 示例：望梅止渴、DNA双螺旋、牛顿第二定律等

### 大学词库
- 特征：学术概念、社会现象、专业领域
- 示例：量子纠缠、区块链、存在主义等

## 错误码说明

| 错误码 | 说明 | 处理建议 |
|--------|------|---------|
| 0 | 成功 | - |
| 10001 | 无效的code | 提示用户重新登录 |
| 10002 | token已过期 | 清除本地token，引导重新授权 |
| 10003 | token无效 | 清除本地token，引导重新授权 |
| 20001 | 词库数据不存在 | 提示用户稍后重试 |
| 20002 | 学段参数错误 | 使用默认学段 |
| 50000 | 服务器内部错误 | 提示用户稍后重试 |

## 开发规划

### V1.0 当前版本
- ✅ 微信授权登录、匿名模式
- ✅ 双人互动、个人练习
- ✅ 学段选择、时间设置、提示开关
- ✅ 四个学段预置词库、本地缓存
- ✅ 10个词汇/局、计时器、答案校验
- ✅ 得分统计、词汇明细
- ✅ 最近20局记录、最佳成绩

### V1.1 计划
- ⏳ 自定义词汇数量
- ⏳ 分享成绩卡片
- ⏳ 完整页面实现

### V1.2 未来
- ⏳ 用户自定义词库
- ⏳ 云端同步记录

### V1.3+ 远期
- ⏳ 排行榜功能
- ⏳ 多人联机模式
- ⏳ 语音识别猜词
- ⏳ AI智能出题

## 注意事项

1. **微信配置**: 需要在微信公众平台配置AppID和AppSecret
2. **网络请求**: 小程序需要配置request合法域名
3. **本地存储**: 游戏记录仅存储在本地，卸载小程序后会清空
4. **词库更新**: 词库数据存储在后端，可通过更新JSON文件扩充

## 性能优化

1. **词库缓存**: 词库数据缓存在内存中，避免重复文件读取
2. **本地存储**: 词汇缓存到小程序本地，减少网络请求
3. **随机算法**: 使用Fisher-Yates算法，O(n)时间复杂度
4. **精确计时**: 使用setInterval实现精确到100ms的计时器

## 常见问题

### Q: 如何添加更多词汇？
A: 编辑 `backend/data/words_*.json` 文件，按照现有格式添加新词汇

### Q: 如何修改游戏时长？
A: 小程序端在设置页面选择展示时间

### Q: 词库为什么不显示？
A: 检查后端服务是否启动，词库JSON文件是否存在

### Q: 如何部署到生产环境？
A: 
1. 修改JWT Secret为复杂密钥
2. 配置正式的微信AppID和AppSecret
3. 部署后端到服务器，配置HTTPS
4. 在微信小程序后台配置服务器域名
5. 上传小程序代码并提交审核

## 许可证

本项目仅供学习和参考使用。

## 联系方式

如有问题或建议，欢迎通过以下方式联系：
- 提交Issue
- 发送邮件

---

**注**: 本项目基于设计文档快速生成，包含完整的后端服务、工具类和项目框架。部分前端页面代码需要根据实际需求继续完善。